/*
 * history API JavaScript Library v3.2.3
 *
 * Support: IE8+, FF3+, Opera 9+, Safari, Chrome, Firefox and other
 *
 * Copyright 2011-2013, Dmitrii Pakhtinov ( spb.piksel@gmail.com )
 *
 * http://spb-piksel.ru/
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 * Update: 06-02-2013
 */
(function(d,t,i,l,O){function B(a,g,b){var e=2===a?d.onhashchange:d.onpopstate,c=2===a?"hashchange":"popstate",h=u[c];o.createEvent?(a=o.createEvent("Events"),a.initEvent(c,i,i)):(a=o.createEventObject(),a.type=c);a.state=k.state;a.oldURL=g;a.newURL=b;e&&e.call(d,a);g=0;for(b=h.length;g<b;g++)h[g].call(d,a)}function I(a){return C?a?C.setItem("__hitoryapi__",P.stringify(a)):P.parse(C.getItem("__hitoryapi__"))||{}:{}}function J(a,g,b){var e=a,c,h=i;if(x||y)for(c in g){if(p.call(g,c))if(y)g[c].get&&
y.call(a,c,g[c].get),g[c].set&&U.call(a,c,g[c].set);else if(x)try{x(a,c,g[c])}catch(m){if(b)return i;h=t;break}}else h=t;if(h&&v){b="StaticClass"+V+v++;e=["Class "+b];"execVB"in d||execScript("Function execVB(c) ExecuteGlobal(c) End Function","VBScript");"VBCVal"in d||execScript("Function VBCVal(o,r) If IsObject(o) Then Set r=o Else r=o End If End Function","VBScript");for(c in a)e[e.length]="Public ["+c+"]";p.call(a,"toString")&&(a.propertyIsEnumerable("toString")||(e[e.length]="Public [toString]"),
g["(toString)"]={get:function(){return this.toString.call(this)}});for(c in g)if(p.call(g,c)&&(g[c].get&&(a["get "+c]=g[c].get,e.push("Public [get "+c+"]","Public "+("(toString)"===c?"Default ":"")+"Property Get ["+c+"]","Call VBCVal(me.[get "+c+"].call(me),["+c+"])","End Property")),g[c].set))a["set "+c]=g[c].set,e.push("Public [set "+c+"]","Public Property Let ["+c+"](v)","Call me.[set "+c+"].call(me,v)","End Property","Public Property Set ["+c+"](v)","Call me.[set "+c+"].call(me,v)","End Property");
e.push("End Class","Function "+b+"Factory()","Set "+b+"Factory=New "+b,"End Function");execVB(e.join("\n"));e=d[b+"Factory"]();for(c in a)e[c]=a[c];p.call(a,"toString")&&(e.toString=a.toString)}return e}var o=d.document,L=o.documentElement,j=d.history||{},b=d.location,m=!!j.pushState,W=m&&j.state===O,s=b.href,P=d.JSON||{},x=Object.defineProperty,y=Object.prototype.__defineGetter__,U=Object.prototype.__defineSetter__,Q=j.pushState,R=j.replaceState,C=d.sessionStorage,p=Object.prototype.hasOwnProperty,
q=+((d.eval&&eval("/*@cc_on 1;@*/")&&/msie (\d+)/i.exec(navigator.userAgent)||[])[1]||0),V=(new Date).getTime(),v=(x||y)&&(!q||8<q)?0:1,w,z,A,D="",E=(w="addEventListener",d[w])||(w="attachEvent",D="on",d[w]),X=(z="removeEventListener",d[z])||(z="detachEvent",d[z]),Y=(A="dispatchEvent",d[A])||(A="fireEvent",d[A]),F=[],S=[],M=0,u={onpopstate:F,popstate:F,onhashchange:S,hashchange:S},n=function(){var a,b,d,e={basepath:"/",redirect:0,type:"/"};d=o.getElementsByTagName("SCRIPT");for(a=0;d[a];a++)if(b=
/(.*)\/(?:history|spike)(?:\.iegte8)?(?:-\d\.\d(?:\.\d)?\w?)?(?:\.min)?.js\?(.*)$/i.exec(d[a].src)||a===d.length-1&&2===(b=d[a].src.split("?")).length&&(b[2]=b[1])&&b){a=0;for(d=b[2].split("&");d[a];)b=d[a++].split("="),e[b[0]]="true"==b[1]?t:"false"==b[1]?i:b[1]||"";e.basepath=e.basepath||"/";break}return e}(),h=function(a){var d,l,e,c,k,j,r;return function(f,Z){var $=RegExp("^"+n.basepath,"i");if(f){if(!m||q)var G=h(),i=G.e,T=G.i,f=/^(?:[\w0-9]+\:)?\/\//.test(f)?0===f.indexOf("/")?T+f:f:T+"//"+
G.h+(0===f.indexOf("/")?f:0===f.indexOf("?")?i+f:0===f.indexOf("#")?i+G.f+f:i.replace(/[^\/]+$/g,"")+f)}else if(f=b.href,!m||Z)f=b.protocol+"//"+b.host+n.basepath+(f.replace(/^[^#]*/,"")||"#").replace(RegExp("^#[/]?(?:"+n.type+")?"),"");if(d!==f){a.href=d=f;j=a.port;k=a.host;r=a.pathname;if("http:"===a.protocol&&80==j||"https:"===a.protocol&&443==j)k=a.hostname,j="";r=0===r.indexOf("/")?r:"/"+r;l=r+a.search+a.hash;c=r.replace($,n.type)+a.search;e=c+a.hash}return{a:a.protocol+"//"+k+l,i:a.protocol,
h:k,j:a.hostname||b.hostname,k:j||b.port,e:r,f:a.search,b:a.hash,c:l,d:c,g:e}}}(o.createElement("a")),k=!v?j:{back:j.back,forward:j.forward,go:j.go,pushState:l,replaceState:l,emulate:!m,toString:function(){return"[object History]"}},H={state:{get:function(){return I()[k.location.href]||l}},length:{get:function(){return j.length}},location:{set:function(a){d.location=a},get:function(){return m?b:N}}},N={assign:function(a){b.assign(m||0!==a.indexOf("#")?a:"#"+h().d+a)},reload:b.reload,replace:function(a){b.replace(m||
0!==a.indexOf("#")?a:"#"+h().d+a)},toString:function(){return this.href}},aa={href:{set:function(a){b.href=a},get:function(){return h().a}},protocol:{set:function(a){b.protocol=a},get:function(){return b.protocol}},host:{set:function(a){b.host=a},get:function(){return b.host}},hostname:{set:function(a){b.hostname=a},get:function(){return b.hostname}},port:{set:function(a){b.port=a},get:function(){return b.port}},pathname:{set:function(a){b.pathname=a},get:function(){return h().e}},search:{set:function(a){b.search=
a},get:function(){return h().f}},hash:{set:function(a){b.hash="#"+h().d+(0===a.indexOf("#")?a:"#"+a)},get:function(){return h().b}}};(!q||7<q)&&function(){function a(){if(s&&!(s=0)&&p.c!==n.basepath)clearInterval(c),setTimeout(B,10)}var g=d.onpopstate||l,q=d.onhashchange||l,e=0,c=l,p=h(),K=p.a;p.b.replace(/^#/,"");E(D+"hashchange",function(a){var f=h();if(M)return K=f.a,M=0;var b=a.oldURL||K,a=K=a.newURL||f.a,f=b.replace(/^.*?(#|$)/,""),d=a.replace(/^.*?(#|$)/,"");b!=a&&!e&&B();s=e=0;f!=d&&B(2,b,
a)},i);E(D+"popstate",function(){if(s===b.href)return s=0;s=0;B(e=1)},i);k.redirect=function(a,f){n.type=a==l?n.type:a;n.basepath=f==l?n.basepath:f;if(d.top==d.self){var c=h(l,t).c,e=b.search,g=b.pathname,f=n.basepath;m?(c!=f&&RegExp("^"+f+"$","i").test(g)&&(b.href=c),RegExp("^"+f+"$","i").test(g+"/"))?b.href=f:RegExp("^"+f,"i").test(g)||(b.href=g.replace(/^\//,f)+e):g!=f&&(b.href=f+"#"+g.replace(RegExp("^"+f,"i"),n.type)+e+b.hash)}};k=J(k,v?H:j.state===O?{state:H.state,location:H.location}:{location:H.location});
N=J(N,aa);d[w]=function(b,f,d){u[b]?(u[b].push(f),!m&&F===u[b]&&a()):3<arguments.length?E(b,f,d,arguments[3]):E(b,f,d)};d[z]=function(a,b,d){var c=u[a];if(c)for(a=c.length;--a;){if(c[a]===b){c.splice(a,1);break}}else X(a,b,d)};d[A]=function(a,b){var c=u[a],e=c===F?d.onpopstate:d.onhashchange;if(c){b=b||("string"==typeof a?d.event:a);try{b&&(b.target=d)}catch(g){try{b.srcElement=d}catch(h){}}e&&e.call(d,b);for(var e=0,k=c.length;e<k;e++)c[e].call(d,b);return t}return Y(a,b)};v&&execScript("Public history, onhashchange",
"VBScript");if((!x&&!y||!J(d,{onhashchange:{get:function(){return q},set:function(a){q=a||l}},onpopstate:{get:function(){return g},set:function(b){(g=b||l)&&!m&&a()}}},1))&&!m)c=setInterval(function(){d.onpopstate&&a()},100);n.redirect&&k.redirect();if(!m)o[w](D+"click",function(a){var b=a||d.event,c=b.target||b.srcElement,a="defaultPrevented"in b?b.defaultPrevented:b.returnValue===i;if(c&&"A"===c.nodeName&&!a&&(a=h(c.getAttribute("href",2),t),a.b&&"#"!==a.b&&a.b===a.a.replace(h().a.split("#").shift(),
""))){history.location.hash=a.b;a=a.b.replace(/^#/,"");if((c=o.getElementById(a))&&c.id===a&&"A"===c.nodeName)c=c.getBoundingClientRect(),d.scrollTo(L.scrollLeft||0,c.top+(L.scrollTop||0)-(L.clientTop||0));b.preventDefault?b.preventDefault():b.returnValue=!1}},i);k.pushState=function(a,c,d,e){var g=I(),j=h().a,i=d&&h(d);s=0;d=i?i.a:j;e&&g[j]&&delete g[j];if((!m||W)&&C&&a)g[d]=a,I(g),a=l;Q&&R?e?R.call(k,a,c,d):Q.call(k,a,c,d):i&&i.c!=h().c&&(M=1,e?b.replace("#"+i.g):b.hash=i.g)};k.replaceState=function(a,
b,c){k.pushState(a,b,c,1)};v?d.history=k:d.history.emulate=!m}()})(window,!0,!1,null);
